---
title: "AE 04 - Hotel Bookings - Data Wrangling"
author: "Your Name"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
  pdf_document:
    toc: true
    latex_engine: xelatex
    keep_tex: false
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

## Introduction

In this application exercise, you'll practice data wrangling skills using a dataset of hotel bookings. This real-world dataset comes from two hotels (a resort hotel and a city hotel) and includes booking information, guest demographics, and stay details.

**In this application exercise, you will:**

- Explore data with `skim()`
- Filter data with multiple conditions
- Use logical operators (`&`, `|`, `!=`, `>=`, etc.)
- Create frequency tables with `count()`
- Calculate summary statistics with `group_by()` and `summarise()`
- Investigate unusual observations
- Practice reproducible data analysis

**Estimated time:** 45-60 minutes

---

## Getting Started

### Fork and Clone Workflow

**Quick reminder:** Work in YOUR forked `application-exercises` repository.

1. Navigate to the `ae-04-hotels` folder in YOUR fork
2. Open `ae-04-hotels.Rmd`
3. Update the YAML with your name
4. Click **Knit** to verify it works

**Detailed instructions in AE 01 if needed.**

---

## Packages
```{r load-packages, warning=FALSE, message=FALSE}
library(tidyverse)
library(skimr)
```

**What these packages do:**

- **tidyverse:** Data wrangling (dplyr) and visualization (ggplot2)
- **skimr:** Provides detailed data summaries

---

## Data
```{r load-data, message=FALSE}
# From TidyTuesday: https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-11/readme.md
hotels <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/hotels.csv")
```

**What this does:**

- `read_csv()`: Reads data from a URL
- The data is stored in the `hotels` object
- This is real hotel booking data from Portugal

---

## Exercise 1: Explore the Data

Warm up! Take a look at an overview of the data with the `skim()` function.

**Note:** The code is already provided. Just run it and examine the output.
```{r hotels-skim}
skim(hotels)
```

**Answer the following questions:**

**How many observations (bookings) are in the dataset?** _____

**How many variables are there?** _____

**What is the data type of the `hotel` variable?** _____

**What is the data type of the `lead_time` variable?** _____

**How many missing values does the `children` variable have?** _____

**Note:** A definition of all variables is given in the [Data dictionary] section at the end. You don't need to memorize all variables, but browse through them to get familiar with the dataset.

---

## Exercise 2: Filter with Multiple Conditions

Are people traveling on a whim? Let's see...

Fill in the blanks for filtering for hotel bookings where the guest is **not** from the US (`country` code `"USA"`) and the `lead_time` is less than 1 day.
```{r travel-whim, eval = FALSE}
#don't forget to switch eval = FALSE to TRUE after filling in the blanks
hotels %>%
  filter(
    country ___ "USA",      # != means "not equal to"
    lead_time ___ ___       # < means "less than"
  )
```

**Hints:**

- Not equal to: `!=`
- Less than: `<`
- Less than 1 day: `< 1`

**Task 2.1:** How many bookings meet these criteria?

**Your answer:** _____ bookings

**Task 2.2:** What does this tell you about spontaneous non-US travelers?

**Your answer:**

___________________________________________________________________________
___________________________________________________________________________

---

## Exercise 3: Logical Operators - OR

How many bookings involve at least 1 child **or** baby?

Fill in the blanks:

- Replace `[AT LEAST]` with the logical operator for "at least" (in two places)
- Replace `[OR]` with the logical operator for "or"
```{r some-children, eval = FALSE}
hotels %>%
  filter(
    children [AT LEAST] 1 [OR] babies [AT LEAST] 1
  )
```

**Hints:**

- "At least 1" means "greater than or equal to 1": `>=`
- "Or" in R: `|`

**How many bookings have at least 1 child or baby?** _____ bookings

**What percentage of total bookings is this?**

Calculate: (bookings with children/babies) / (total bookings) × 100

**Your answer:** About _____% of bookings include children or babies.

---

## Exercise 4: Compare Hotel Types

Do you think it's more likely to find bookings with children or babies in city hotels or resort hotels? Test your intuition. 

**Task 4.1:** Make a prediction first.

**Your prediction:** I think ___________ hotels will have more bookings with children/babies because ________________________________________________

**Task 4.2:** Filter for resort hotel bookings with more than 1 child **or** baby.
```{r resort-children, eval = FALSE}
# Filter for resort hotels with children or babies
hotels %>%
  filter(
    hotel == "___",                    # Resort Hotel
    children ___ 1 | babies ___ 1      # At least 1 child OR baby
  )
```

**Number of resort hotel bookings with children/babies:** _____

**Task 4.3:** Now do the same for city hotels.
```{r city-children,eval=FALSE}
# Filter for city hotels with children or babies
hotels %>%
  filter(
    hotel == "___",                    # City Hotel
    children ___ 1 | babies ___ 1      # At least 1 child OR baby
  )
```

**Number of city hotel bookings with children/babies:** _____

**Task 4.4:** Which hotel type has more bookings with children/babies? Was your prediction correct?

**Your answer:**

___________________________________________________________________________
___________________________________________________________________________

---

## Exercise 5: Frequency Tables

Create a frequency table of the number of `adults` in a booking. Display the results in descending order so the most common observation is on top. 

**What is the most common number of adults in bookings in this dataset? Are there any surprising results?**
```{r adults-frequency, eval = FALSE}
# Create frequency table
hotels %>%
  count(___, sort = ___) %>%    # Count adults, sort in descending order
  arrange(desc(___))             # Arrange by count (n) in descending order
```

**Hints:**

- `count(variable)`: Creates a frequency table
- `sort = TRUE`: Automatically sorts by count in descending order
- Or use `arrange(desc(n))` to sort manually

**Task 5.1:** What is the most common number of adults?

**Your answer:** _____ adults

**Task 5.2:** What surprising result(s) do you see?

**Your answer:**

___________________________________________________________________________
___________________________________________________________________________

**Hint:** Look at the minimum and maximum values. Do they make sense for hotel bookings?

---

## Exercise 6: Investigate by Cancellation Status

Repeat Exercise 5, once for canceled bookings (`is_canceled` coded as 1) and once for not canceled bookings (`is_canceled` coded as 0). What does this reveal about the surprising results you spotted in the previous exercise?

**Task 6.1:** Frequency table for CANCELED bookings.
```{r canceled-adults, eval = FALSE}
# Filter for canceled bookings, then count adults
hotels %>%
  filter(is_canceled == ___) %>%
  count(___, sort = TRUE)
```

**Task 6.2:** Frequency table for NOT CANCELED bookings.
```{r not-canceled-adults, eval = FALSE}
# Filter for not canceled bookings, then count adults
hotels %>%
  filter(is_canceled == ___) %>%
  count(___, sort = TRUE)
```

**Task 6.3:** What does this reveal about the surprising results from Exercise 5?

**Your answer:**

The unusual values (like 0 adults) appear more frequently in _____________ bookings. This suggests that _____________________________________________
___________________________________________________________________________
___________________________________________________________________________

---

## Exercise 7: Group Summary Statistics

Calculate minimum, mean, median, and maximum average daily rate (`adr`) grouped by `hotel` type so that you can get these statistics separately for resort and city hotels. Which type of hotel is higher, on average?
```{r hotel-adr-summary, eval = FALSE}
hotels %>%
  group_by(___) %>%
  summarise(
    min_adr = min(___),
    mean_adr = mean(___),
    median_adr = median(___),
    max_adr = max(___)
  )
```

**What this code does:**

- `group_by(hotel)`: Creates groups for Resort Hotel and City Hotel
- `summarise()`: Calculates statistics for each group
- `min()`, `mean()`, `median()`, `max()`: Summary functions

**Task 7.1:** Fill in the table below with your results:

| Statistic | Resort Hotel | City Hotel |
|:----------|:-------------|:-----------|
| Minimum   |              |            |
| Mean      |              |            |
| Median    |              |            |
| Maximum   |              |            |

**Task 7.2:** Which type of hotel has a higher average daily rate?

**Your answer:**

___________________________________________________________________________

**Task 7.3:** What unusual values do you notice in the summary statistics?

**Your answer:**

___________________________________________________________________________
___________________________________________________________________________

**Hint:** Look at the minimum and maximum values. Are they realistic?

---

## Exercise 8: Investigate Unusual Observations

We observe two unusual values in the summary statistics above -- a negative minimum, and a very high maximum. What types of hotels are these? Locate these observations in the dataset and find out the arrival date (year and month) as well as how many people (adults, children, and babies) stayed in the room.

**Hint:** For example, you can `filter` for the given `adr` amounts and `select` the relevant columns.

**Task 8.1:** Investigate the negative ADR value.
```{r negative-adr, eval = FALSE}
# Filter for negative adr and select relevant columns
hotels %>%
  filter(adr ___ ___) %>%                           # adr less than 0
  select(hotel, adr, arrival_date_year, 
         arrival_date_month, adults, children, babies)
```

**Your findings:**

**Hotel type:** _____

**Arrival year:** _____

**Arrival month:** _____

**Number of adults:** _____

**Number of children:** _____

**Number of babies:** _____

**Why might this ADR be negative?**

___________________________________________________________________________

**Task 8.2:** Investigate the very high maximum ADR.

First, determine what the maximum is from Exercise 7, then filter for it.
```{r high-adr, eval = FALSE}
# Filter for the maximum adr you found in Exercise 7
hotels %>%
  filter(adr == ___) %>%                            # Use the max value you found
  select(hotel, adr, arrival_date_year, 
         arrival_date_month, adults, children, babies)
```

**Your findings:**

**Hotel type:** _____

**Arrival year:** _____

**Arrival month:** _____

**Number of adults:** _____

**Number of children:** _____

**Number of babies:** _____

**Why might this ADR be so high? Is this realistic?**

___________________________________________________________________________
___________________________________________________________________________

**Task 8.3:** Should these unusual values be removed from the dataset? Why or why not?

**Your answer:**

___________________________________________________________________________
___________________________________________________________________________
___________________________________________________________________________

---

## Exercise 9: Challenge (Optional)

**Task 9.1:** Create a new variable called `total_guests` that sums `adults`, `children`, and `babies`. Then calculate the average number of total guests by hotel type.
```{r total-guests, eval = FALSE}
# Your code here
hotels %>%
  mutate(total_guests = ___ + ___ + ___) %>%
  group_by(___) %>%
  summarise(avg_guests = mean(___))
```

**Task 9.2:** Which months have the highest number of bookings? Create a frequency table of `arrival_date_month`.

**Hint:** You might want to convert month to a factor with the correct order so they display chronologically.
```{r bookings-by-month}
# Your code here
```

**Which month has the most bookings?** _____

---

## Reflection

**Task:** Reflect on what you learned.

**What was the most interesting finding from this data?**

___________________________________________________________________________
___________________________________________________________________________

**Which data wrangling skill was most useful in this exercise?**

___________________________________________________________________________

**What would you want to investigate further in this dataset?**

___________________________________________________________________________
___________________________________________________________________________

---

## Knit and Submit

**Before you finish:**

1. ✅ Make sure all code chunks run without errors
2. ✅ Fill in all blanks and answer all questions
3. ✅ Knit to HTML first to verify everything works
4. ✅ Review the HTML output

**Git workflow:**

1. Click the **Git** pane
2. Check boxes next to all changed files
3. Click **Commit**
4. Write a commit message: "Completed AE 04 - Hotels"
5. Click **Commit**
6. Click **Push**
7. Verify your work is on GitHub in **YOUR fork**

---

## Generate PDF for Canvas Submission

Once everything works in HTML:

1. Click the **Knit** dropdown arrow
2. Select **Knit to PDF**
3. Wait for PDF generation
4. Find `ae-04-hotels.pdf` in the Files pane
5. Export and save to your computer
6. Submit the PDF to Canvas

**Remember:** Submit to BOTH GitHub (your .Rmd) AND Canvas (the PDF)!

---

## Data Dictionary {#data-dictionary}

Below is the full data dictionary. Note that it is long (there are lots of variables in the data), but we will be using a limited set of the variables for our analysis.

| variable | class | description |
|:------------|:------------|:----------------------------------------------|
| hotel | character | Hotel (Resort Hotel or City Hotel) |
| is_canceled | double | Value indicating if the booking was canceled (1) or not (0) |
| lead_time | double | Number of days that elapsed between the entering date of the booking into the PMS and the arrival date |
| arrival_date_year | double | Year of arrival date |
| arrival_date_month | character | Month of arrival date |
| arrival_date_week_number | double | Week number of year for arrival date |
| arrival_date_day_of_month | double | Day of arrival date |
| stays_in_weekend_nights | double | Number of weekend nights (Saturday or Sunday) the guest stayed or booked to stay at the hotel |
| stays_in_week_nights | double | Number of week nights (Monday to Friday) the guest stayed or booked to stay at the hotel |
| adults | double | Number of adults |
| children | double | Number of children |
| babies | double | Number of babies |
| meal | character | Type of meal booked. Categories are presented in standard hospitality meal packages: <br> Undefined/SC -- no meal package;<br>BB -- Bed & Breakfast; <br> HB -- Half board (breakfast and one other meal -- usually dinner); <br> FB -- Full board (breakfast, lunch and dinner) |
| country | character | Country of origin. Categories are represented in the ISO 3155--3:2013 format |
| market_segment | character | Market segment designation. In categories, the term "TA" means "Travel Agents" and "TO" means "Tour Operators" |
| distribution_channel | character | Booking distribution channel. The term "TA" means "Travel Agents" and "TO" means "Tour Operators" |
| is_repeated_guest | double | Value indicating if the booking name was from a repeated guest (1) or not (0) |
| previous_cancellations | double | Number of previous bookings that were cancelled by the customer prior to the current booking |
| previous_bookings_not_canceled | double | Number of previous bookings not cancelled by the customer prior to the current booking |
| reserved_room_type | character | Code of room type reserved. Code is presented instead of designation for anonymity reasons |
| assigned_room_type | character | Code for the type of room assigned to the booking. Sometimes the assigned room type differs from the reserved room type due to hotel operation reasons (e.g. overbooking) or by customer request. Code is presented instead of designation for anonymity reasons |
| booking_changes | double | Number of changes/amendments made to the booking from the moment the booking was entered on the PMS until the moment of check-in or cancellation |
| deposit_type | character | Indication on if the customer made a deposit to guarantee the booking. This variable can assume three categories:<br>No Deposit -- no deposit was made;<br>Non Refund -- a deposit was made in the value of the total stay cost;<br>Refundable -- a deposit was made with a value under the total cost of stay. |
| agent | character | ID of the travel agency that made the booking |
| company | character | ID of the company/entity that made the booking or responsible for paying the booking. ID is presented instead of designation for anonymity reasons |
| days_in_waiting_list | double | Number of days the booking was in the waiting list before it was confirmed to the customer |
| customer_type | character | Type of booking, assuming one of four categories:<br>Contract - when the booking has an allotment or other type of contract associated to it;<br>Group -- when the booking is associated to a group;<br>Transient -- when the booking is not part of a group or contract, and is not associated to other transient booking;<br>Transient-party -- when the booking is transient, but is associated to at least other transient booking |
| adr | double | Average Daily Rate as defined by dividing the sum of all lodging transactions by the total number of staying nights |
| required_car_parking_spaces | double | Number of car parking spaces required by the customer |
| total_of_special_requests | double | Number of special requests made by the customer (e.g. twin bed or high floor) |
| reservation_status | character | Reservation last status, assuming one of three categories:<br>Canceled -- booking was canceled by the customer;<br>Check-Out -- customer has checked in but already departed;<br>No-Show -- customer did not check-in and did inform the hotel of the reason why |
| reservation_status_date | double | Date at which the last status was set. This variable can be used in conjunction with the ReservationStatus to understand when was the booking canceled or when did the customer checked-out of the hotel |

---

## Troubleshooting

**Common issues:**

- **Error: "could not find function":** Make sure you loaded the packages
- **Logical operator not working:** Common operators:
  - Not equal: `!=`
  - Less than: `<`
  - Greater than or equal: `>=`
  - And: `&`
  - Or: `|`
- **Data not loading:** Check your internet connection; the data loads from a URL
- **Wrong number of rows:** Check your filter conditions carefully

**Filter issues:**
- **Multiple conditions with AND:** Use comma or `&`: `filter(x > 5, y < 10)` or `filter(x > 5 & y < 10)`
- **Multiple conditions with OR:** Use `|`: `filter(x > 5 | y < 10)`
- **Not equal:** Use `!=`: `filter(country != "USA")`

**Summary statistics issues:**
- **Missing values cause NA results:** Use `na.rm = TRUE` in summary functions
- **Forgot to group_by:** Summary stats will be for entire dataset, not by groups

**PDF issues:**
- **LaTeX not found:** Install tinytex: `tinytex::install_tinytex()`
- **Table too wide for PDF:** This is okay - focus on the content in your HTML version

**If you're stuck:**
- Review the walkthrough video
- Check dplyr documentation: `?filter`, `?group_by`, `?summarise`
- Ask on the discussion board
- Attend office hours

---

## Quick Reference: Logical Operators

| Operator | Meaning | Example |
|:---------|:--------|:--------|
| `==` | Equal to | `hotel == "Resort Hotel"` |
| `!=` | Not equal to | `country != "USA"` |
| `<` | Less than | `lead_time < 1` |
| `<=` | Less than or equal to | `adults <= 2` |
| `>` | Greater than | `adr > 100` |
| `>=` | Greater than or equal to | `children >= 1` |
| `&` | And (both conditions must be true) | `adults >= 2 & children >= 1` |
| `|` | Or (at least one condition must be true) | `children >= 1 | babies >= 1` |
| `!` | Not | `!is_canceled` |